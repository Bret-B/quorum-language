package Science.Tests
use Libraries.Testing.Test
use Libraries.Compute.Statistics.Distributions.NormalDistribution

/*
    This class tests pearson correlations.
*/
class NormalDistributionTest is Test

    on create
        SetName("Normal Distribution test")
        //The library we use for this appears to only be accurate down to 4 decimal places
        //That is lower than our standard threshold value. Override it so we document
        //the limitation.
        SetThreshold(0.0001)
    end

    action CheckAreaUnderCurve
        NormalDistribution distribution

        //NormalDistribution distribution
        CustomCheck(distribution:CumulativeDistribution(-5), 0.0000002866515719)
        CustomCheck(distribution:CumulativeDistribution(-4.9), 0.0000004791832768)
        CustomCheck(distribution:CumulativeDistribution(-4.8), 0.0000007933281518)
        CustomCheck(distribution:CumulativeDistribution(-4.7), 0.000001300807454)
        CustomCheck(distribution:CumulativeDistribution(-4.6), 0.000002112454703)
        CustomCheck(distribution:CumulativeDistribution(-4.5), 0.000003397673125)
        CustomCheck(distribution:CumulativeDistribution(-4.4), 0.000005412543908)
        CustomCheck(distribution:CumulativeDistribution(-4.3), 0.000008539905471)
        CustomCheck(distribution:CumulativeDistribution(-4.2), 0.00001334574902)
        CustomCheck(distribution:CumulativeDistribution(-4.1), 0.00002065750691)
        CustomCheck(distribution:CumulativeDistribution(-4.0), 0.00003167124183)
        
        CustomCheck(distribution:CumulativeDistribution(-3.9), 0.00004809634402)
        CustomCheck(distribution:CumulativeDistribution(-3.8), 0.00007234804393)
        CustomCheck(distribution:CumulativeDistribution(-3.7), 0.0001077997335)
        CustomCheck(distribution:CumulativeDistribution(-3.6), 0.0001591085902)
        CustomCheck(distribution:CumulativeDistribution(-3.5), 0.000232629079)
        CustomCheck(distribution:CumulativeDistribution(-3.4), 0.0003369292657)
        CustomCheck(distribution:CumulativeDistribution(-3.3), 0.0004834241424)
        CustomCheck(distribution:CumulativeDistribution(-3.2), 0.0006871379379)
        CustomCheck(distribution:CumulativeDistribution(-3.1), 0.0009676032132)
        CustomCheck(distribution:CumulativeDistribution(-3.0), 0.001349898032)

        CustomCheck(distribution:CumulativeDistribution(-2.9), 0.0018658133)
        CustomCheck(distribution:CumulativeDistribution(-2.8), 0.00255513033)
        CustomCheck(distribution:CumulativeDistribution(-2.7), 0.003466973803)
        CustomCheck(distribution:CumulativeDistribution(-2.6), 0.004661188024)
        CustomCheck(distribution:CumulativeDistribution(-2.5), 0.006209665326)
        CustomCheck(distribution:CumulativeDistribution(-2.4), 0.008197535925)
        CustomCheck(distribution:CumulativeDistribution(-2.3), 0.01072411002)
        CustomCheck(distribution:CumulativeDistribution(-2.2), 0.01390344751)
        CustomCheck(distribution:CumulativeDistribution(-2.1), 0.01786442056)
        CustomCheck(distribution:CumulativeDistribution(-2.0), 0.02275013195)

        CustomCheck(distribution:CumulativeDistribution(-1.9), 0.02871655982)
        CustomCheck(distribution:CumulativeDistribution(-1.8), 0.03593031911)
        CustomCheck(distribution:CumulativeDistribution(-1.7), 0.04456546276)
        CustomCheck(distribution:CumulativeDistribution(-1.6), 0.0547992917)
        CustomCheck(distribution:CumulativeDistribution(-1.5), 0.06680720127)
        CustomCheck(distribution:CumulativeDistribution(-1.4), 0.08075665923)
        CustomCheck(distribution:CumulativeDistribution(-1.3), 0.09680048459)
        CustomCheck(distribution:CumulativeDistribution(-1.2), 0.1150696702)
        CustomCheck(distribution:CumulativeDistribution(-1.1), 0.1356660609)
        CustomCheck(distribution:CumulativeDistribution(-1.0), 0.1586552539)

        CustomCheck(distribution:CumulativeDistribution(-0.9), 0.1840601253)
        CustomCheck(distribution:CumulativeDistribution(-0.8), 0.2118553986)
        CustomCheck(distribution:CumulativeDistribution(-0.7), 0.2419636522)
        CustomCheck(distribution:CumulativeDistribution(-0.6), 0.2742531178)
        CustomCheck(distribution:CumulativeDistribution(-0.5), 0.3085375387)
        CustomCheck(distribution:CumulativeDistribution(-0.4), 0.3445782584)
        CustomCheck(distribution:CumulativeDistribution(-0.3), 0.3820885778)
        CustomCheck(distribution:CumulativeDistribution(-0.2), 0.4207402906)
        CustomCheck(distribution:CumulativeDistribution(-0.1), 0.4601721627)
        CustomCheck(distribution:CumulativeDistribution(0.0), 0.5)

        CustomCheck(distribution:CumulativeDistribution(0.1), 0.5398278373)
        CustomCheck(distribution:CumulativeDistribution(0.2), 0.5792597094)
        CustomCheck(distribution:CumulativeDistribution(0.3), 0.6179114222)
        CustomCheck(distribution:CumulativeDistribution(0.4), 0.6554217416)
        CustomCheck(distribution:CumulativeDistribution(0.5), 0.6914624613)
        CustomCheck(distribution:CumulativeDistribution(0.6), 0.7257468822)
        CustomCheck(distribution:CumulativeDistribution(0.7), 0.7580363478)
        CustomCheck(distribution:CumulativeDistribution(0.8), 0.7881446014)
        CustomCheck(distribution:CumulativeDistribution(0.9), 0.8159398747)
        CustomCheck(distribution:CumulativeDistribution(1.0), 0.8413447461)

        CustomCheck(distribution:CumulativeDistribution(1.1), 0.8643339391)
        CustomCheck(distribution:CumulativeDistribution(1.2), 0.8849303298)
        CustomCheck(distribution:CumulativeDistribution(1.3), 0.9031995154)
        CustomCheck(distribution:CumulativeDistribution(1.4), 0.9192433408)
        CustomCheck(distribution:CumulativeDistribution(1.5), 0.9331927987)
        CustomCheck(distribution:CumulativeDistribution(1.6), 0.9452007083)
        CustomCheck(distribution:CumulativeDistribution(1.7), 0.9554345372)
        CustomCheck(distribution:CumulativeDistribution(1.8), 0.9640696809)
        CustomCheck(distribution:CumulativeDistribution(1.9), 0.9712834402)
        CustomCheck(distribution:CumulativeDistribution(2.0), 0.9772498681)

        CustomCheck(distribution:CumulativeDistribution(2.1), 0.9821355794)
        CustomCheck(distribution:CumulativeDistribution(2.2), 0.9860965525)
        CustomCheck(distribution:CumulativeDistribution(2.3), 0.98927589)
        CustomCheck(distribution:CumulativeDistribution(2.4), 0.9918024641)
        CustomCheck(distribution:CumulativeDistribution(2.5), 0.9937903347)
        CustomCheck(distribution:CumulativeDistribution(2.6), 0.995338812)
        CustomCheck(distribution:CumulativeDistribution(2.7), 0.9965330262)
        CustomCheck(distribution:CumulativeDistribution(2.8), 0.9974448697)
        CustomCheck(distribution:CumulativeDistribution(2.9), 0.9981341867)
        CustomCheck(distribution:CumulativeDistribution(3.0), 0.998650102)

        CustomCheck(distribution:CumulativeDistribution(3.1), 0.9990323968)
        CustomCheck(distribution:CumulativeDistribution(3.2), 0.9993128621)
        CustomCheck(distribution:CumulativeDistribution(3.3), 0.9995165759)
        CustomCheck(distribution:CumulativeDistribution(3.4), 0.9996630707)
        CustomCheck(distribution:CumulativeDistribution(3.5), 0.9997673709)
        CustomCheck(distribution:CumulativeDistribution(3.6), 0.9998408914)
        CustomCheck(distribution:CumulativeDistribution(3.7), 0.9998922003)
        CustomCheck(distribution:CumulativeDistribution(3.8), 0.999927652)
        CustomCheck(distribution:CumulativeDistribution(3.9), 0.9999519037)
        CustomCheck(distribution:CumulativeDistribution(4.0), 0.9999683288)

        CustomCheck(distribution:CumulativeDistribution(4.1), 0.9999793425)
        CustomCheck(distribution:CumulativeDistribution(4.2), 0.9999866543)
        CustomCheck(distribution:CumulativeDistribution(4.3), 0.9999914601)
        CustomCheck(distribution:CumulativeDistribution(4.4), 0.9999945875)
        CustomCheck(distribution:CumulativeDistribution(4.5), 0.9999966023)
        CustomCheck(distribution:CumulativeDistribution(4.6), 0.9999978875)
        CustomCheck(distribution:CumulativeDistribution(4.7), 0.9999986992)
        CustomCheck(distribution:CumulativeDistribution(4.8), 0.9999992067)
        CustomCheck(distribution:CumulativeDistribution(4.9), 0.9999995208)
        CustomCheck(distribution:CumulativeDistribution(5.0), 0.9999997133)
    end

    action CheckParameterForArea
        NormalDistribution distribution
        CustomCheck(distribution:InverseCumulativeDistribution(0.0000002866515719), -5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0000004791832768), -4.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0000007933281518), -4.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000001300807454), -4.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000002112454703), -4.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000003397673125), -4.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000005412543908), -4.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000008539905471), -4.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.00001334574902), -4.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.00002065750691), -4.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.00003167124183), -4.0)
        
        CustomCheck(distribution:InverseCumulativeDistribution(0.00004809634402), -3.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.00007234804393), -3.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0001077997335), -3.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0001591085902), -3.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.000232629079), -3.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0003369292657), -3.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0004834241424), -3.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0006871379379), -3.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0009676032132), -3.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.001349898032), -3.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.0018658133), -2.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.00255513033), -2.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.003466973803), -2.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.004661188024), -2.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.006209665326), -2.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.008197535925), -2.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.01072411002), -2.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.01390344751), -2.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.01786442056), -2.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.02275013195), -2.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.02871655982), -1.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.03593031911), -1.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.04456546276), -1.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.0547992917), -1.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.06680720127), -1.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.08075665923), -1.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.09680048459), -1.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.1150696702), -1.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.1356660609), -1.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.1586552539), -1.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.1840601253), -0.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.2118553986), -0.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.2419636522), -0.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.2742531178), -0.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.3085375387), -0.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.3445782584), -0.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.3820885778), -0.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.4207402906), -0.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.4601721627), -0.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.5), 0.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.5398278373), 0.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.5792597094), 0.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.6179114222), 0.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.6554217416), 0.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.6914624613), 0.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.7257468822), 0.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.7580363478), 0.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.7881446014), 0.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.8159398747), 0.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.8413447461), 1.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.8643339391), 1.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.8849303298), 1.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9031995154), 1.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9192433408), 1.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9331927987), 1.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9452007083), 1.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9554345372), 1.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9640696809), 1.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9712834402), 1.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9772498681), 2.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.9821355794), 2.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9860965525), 2.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.98927589), 2.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9918024641), 2.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9937903347), 2.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.995338812), 2.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9965330262), 2.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9974448697), 2.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9981341867), 2.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.998650102), 3.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.9990323968), 3.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9993128621), 3.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9995165759), 3.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9996630707), 3.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9997673709), 3.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9998408914), 3.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9998922003), 3.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.999927652), 3.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999519037), 3.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999683288), 4.0)

        CustomCheck(distribution:InverseCumulativeDistribution(0.9999793425), 4.1)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999866543), 4.2)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999914601), 4.3)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999945875), 4.4)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999966023), 4.5)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999978875), 4.6)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999986992), 4.7)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999992067), 4.8)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999995208), 4.9)
        CustomCheck(distribution:InverseCumulativeDistribution(0.9999997133), 5.0)
    end

    action Run
        CheckAreaUnderCurve()
        CheckParameterForArea()
    end

    private action CustomCheck(number value, number expectation)
        Check(value, expectation)
    end
end