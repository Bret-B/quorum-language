package Libraries.Robots.Spike

use Libraries.System.SerialPort
use Libraries.System.Serial
class Spike
constant text SPIKE_WIRED_NAME = "SPIKE Prime VCP"
    integer baudRate = 115200
    integer readTimeout = 250
    integer writeTimeout = 0
Serial serial
    SerialPort port = undefined
    
    /*This action returns undefined if there is no active port. A connection must be made before
getting this value. */
    action GetOpenPort returns SerialPort
        return port
    end
    
action FindWiredPort returns SerialPort
        return serial:FindPort(SPIKE_WIRED_NAME)
    end
    
    
    
action SetDefaultPortSettings
        if port not= undefined
port:SetTimeouts(port:GetDefaultTimeout(), readTimeout, writeTimeout)
            port:SetBaudRate(baudRate)
        end
    end
    
    action Connect returns boolean
        if port not= undefined
            port:Close()
            port = undefined
        end
        port = FindWiredPort()
        if port not= undefined
            SetDefaultPortSettings()
            boolean success = port:Open()
            if not success
                port = undefined
                return false
            else
                return true
            end
        end
        return false
    end
end